---
title: 开发优秀的驱动程序
date: 2008-04-18 15:06:15
img: '/medias/1.jpg'
categories:
- WinCE
---


## 开发优秀的驱动程序

作为驱动开发工程师,我们需要在每一行代码上下功夫,因为驱动程序的效率直接影响着系统的性能.而新手往往不会注意到这些细节。以为功能实现以后就万事大吉了，其实不然，好的驱动程序不只是能实现预期的功能。它同样需要高的效率与规范的风格。用户花钱买我们系统是给他/她做事的，而不是给我们做测试的，所以我们要尽可能提高效率。同时好的代码风格能大大降低我们自己的维护成本。

高效率看似容易，但要注意到每个细节还是挺难的，我们可以从以下几点去注意这个问题：

1.不要使用无关的代码，这点容易理解，尤其是调试代码，RELEASE时一定要去除这些代码。

2.去掉多余的函数调用，尽可能的保存一些数据。即使是最快的函数，调用它时也会引发压栈与出栈，所以要尽量少做函数调用。当然如果一个函数返回的数据比较大，保存那些数据将占用比较多的内在空间，保存返回值就得不偿失了。比如，看到有的人每次在使用一个地址时就调用MmmapIoSpace将这个地址映射到程序地址空间，用完以后又立即Unmap这个地址，下次使用时又做MAP，这就是一种及不好的方法，每次需要多调用两个系统函数。

3．如果可行，不要在循环中使用条件判断，尤其在一个次数很多的循环中更应该如此。

比如：

For( i=0; i<1000;>

If( m==1) ..

Else if (m==2 )….

Else …..

}

这种代码，我们可以把If 写在for 之外，即，每一种不同的条件写一个循环体。

If( m==1) for ...

Else if (m==2 ) for ….

Else for …..